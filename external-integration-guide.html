<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دليل التكامل مع Organization Chart API</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        .error {
            background: #f8d7da;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
        h1, h2, h3 {
            color: #333;
        }
        .step {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔗 دليل التكامل مع Organization Chart API</h1>
        
        <div class="highlight">
            <strong>📍 رابط الموقع المنشور:</strong> 
            <a href="https://workenrich-org-chart-qa3e.bolt.host" target="_blank">
                https://workenrich-org-chart-qa3e.bolt.host
            </a>
        </div>

        <h2>🚀 الطريقة الأساسية للاستخدام</h2>
        
        <div class="step">
            <h3>الخطوة 1: تضمين الـ iframe في موقعك</h3>
        </div>
        
        <div class="code-block">
&lt;!-- في صفحة HTML الخاصة بك --&gt;
&lt;iframe 
    id="orgChartFrame"
    src="https://workenrich-org-chart-qa3e.bolt.host" 
    width="100%" 
    height="600px"
    frameborder="0"&gt;
&lt;/iframe&gt;
        </div>

        <div class="step">
            <h3>الخطوة 2: انتظار جاهزية الـ API</h3>
        </div>

        <div class="code-block">
&lt;script&gt;
// انتظار تحميل الـ iframe
document.getElementById('orgChartFrame').onload = function() {
    console.log('📱 iframe تم تحميله');
    
    // انتظار جاهزية الـ API
    window.addEventListener('OrgChartReady', function() {
        console.log('✅ Organization Chart API جاهز!');
        
        // هنا يمكنك إرسال البيانات
        sendDataToChart();
    });
};
&lt;/script&gt;
        </div>

        <div class="step">
            <h3>الخطوة 3: إرسال البيانات</h3>
        </div>

        <h3>📋 شكل البيانات المطلوب:</h3>
        
        <div class="code-block">
function sendDataToChart() {
    // شكل البيانات الصحيح
    const employeeData = {
        name: 'Aya Emad',                    // اسم الموظف (مطلوب)
        position: 'CEO',                     // المنصب (مطلوب)
        jobTitleCode: 1,                     // كود المنصب (مطلوب)
        level: 'Executive',                  // المستوى (مطلوب)
        expanded: true,                      // هل العقدة متوسعة؟
        firstNode: true,                     // هل هذا الجذر؟
        children: [                          // الموظفين التابعين
            {
                name: 'Omar Tarek',
                position: 'CTO',
                jobTitleCode: 2,
                level: 'Senior Management',
                expanded: false,
                children: [
                    {
                        name: 'Ahmed Ali',
                        position: 'Senior Developer',
                        jobTitleCode: 3,
                        level: 'Staff',
                        expanded: false,
                        children: []
                    }
                ]
            },
            {
                name: 'Nour Hany',
                position: 'CMO',
                jobTitleCode: 4,
                level: 'Senior Management',
                expanded: false,
                children: []
            }
        ]
    };
    
    // إرسال البيانات للمخطط
    window.OrgChartAPI.setData(employeeData, 'orgChart');
}
        </div>

        <h2>🔧 مثال كامل للتكامل</h2>
        
        <div class="code-block">
&lt;!DOCTYPE html&gt;
&lt;html lang="ar"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;موقعي مع Organization Chart&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;المخطط التنظيمي لشركتي&lt;/h1&gt;
    
    &lt;!-- أزرار التحكم --&gt;
    &lt;button onclick="loadMyData()"&gt;تحميل البيانات&lt;/button&gt;
    &lt;button onclick="expandAll()"&gt;توسيع الكل&lt;/button&gt;
    &lt;button onclick="collapseAll()"&gt;طي الكل&lt;/button&gt;
    
    &lt;!-- المخطط التنظيمي --&gt;
    &lt;iframe 
        id="orgChart"
        src="https://workenrich-org-chart-qa3e.bolt.host" 
        width="100%" 
        height="600px"
        frameborder="0"&gt;
    &lt;/iframe&gt;

    &lt;script&gt;
        let apiReady = false;
        
        // انتظار تحميل الـ iframe
        document.getElementById('orgChart').onload = function() {
            // انتظار جاهزية الـ API
            window.addEventListener('OrgChartReady', function() {
                console.log('✅ API جاهز!');
                apiReady = true;
                
                // تحميل البيانات تلقائياً
                loadMyData();
            });
            
            // الاستماع لأحداث النجاح
            window.addEventListener('OrgChartDataSet', function(e) {
                console.log('✅ تم تحميل البيانات:', e.detail);
                alert('تم تحميل ' + e.detail.itemCount + ' موظف بنجاح!');
            });
        };
        
        // دالة تحميل بياناتك
        function loadMyData() {
            if (!apiReady) {
                alert('⚠️ الـ API لم يصبح جاهزاً بعد');
                return;
            }
            
            // بياناتك الحقيقية
            const myCompanyData = {
                name: 'Aya Emad',
                position: 'Chief Executive Officer',
                jobTitleCode: 1,
                level: 'Executive',
                expanded: true,
                firstNode: true,
                children: [
                    {
                        name: 'Omar Tarek',
                        position: 'Chief Technology Officer',
                        jobTitleCode: 2,
                        level: 'Senior Management',
                        expanded: false,
                        children: [
                            {
                                name: 'Ahmed Salem',
                                position: 'Senior Full Stack Developer',
                                jobTitleCode: 3,
                                level: 'Staff',
                                expanded: false,
                                children: []
                            },
                            {
                                name: 'Fatima Ali',
                                position: 'Frontend Developer',
                                jobTitleCode: 4,
                                level: 'Staff',
                                expanded: false,
                                children: []
                            }
                        ]
                    },
                    {
                        name: 'Nour Hany',
                        position: 'Chief Marketing Officer',
                        jobTitleCode: 5,
                        level: 'Senior Management',
                        expanded: false,
                        children: [
                            {
                                name: 'Sara Mohamed',
                                position: 'Marketing Manager',
                                jobTitleCode: 6,
                                level: 'Middle Management',
                                expanded: false,
                                children: []
                            }
                        ]
                    }
                ]
            };
            
            // إرسال البيانات
            window.OrgChartAPI.setData(myCompanyData, 'orgChart');
        }
        
        // دوال التحكم
        function expandAll() {
            if (apiReady) {
                window.OrgChartAPI.expandAll();
            }
        }
        
        function collapseAll() {
            if (apiReady) {
                window.OrgChartAPI.collapseAll();
            }
        }
        
        // مثال على جلب البيانات من API خارجي
        function loadDataFromAPI() {
            if (!apiReady) return;
            
            fetch('/api/employees')
                .then(response =&gt; response.json())
                .then(data =&gt; {
                    // تحويل البيانات للشكل المطلوب
                    const formattedData = formatDataForOrgChart(data);
                    
                    // إرسال للمخطط
                    window.OrgChartAPI.setData(formattedData, 'orgChart');
                })
                .catch(error =&gt; {
                    console.error('خطأ في جلب البيانات:', error);
                });
        }
        
        // دالة تحويل البيانات
        function formatDataForOrgChart(apiData) {
            // حول بيانات الـ API للشكل المطلوب
            return {
                name: apiData.ceo_name,
                position: apiData.ceo_position,
                jobTitleCode: 1,
                level: 'Executive',
                expanded: true,
                firstNode: true,
                children: apiData.departments.map((dept, index) =&gt; ({
                    name: dept.manager_name,
                    position: dept.manager_position,
                    jobTitleCode: index + 2,
                    level: 'Senior Management',
                    expanded: false,
                    children: dept.employees.map((emp, empIndex) =&gt; ({
                        name: emp.name,
                        position: emp.position,
                        jobTitleCode: (index + 2) * 10 + empIndex,
                        level: emp.level || 'Staff',
                        expanded: false,
                        children: []
                    }))
                }))
            };
        }
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
        </div>

        <h2>📊 المستويات المدعومة</h2>
        
        <div class="code-block">
const supportedLevels = [
    'Executive',           // الإدارة العليا
    'Senior Management',   // الإدارة العليا
    'Middle Management',   // الإدارة الوسطى
    'Junior Management',   // الإدارة المبتدئة
    'Senior Staff',        // الموظفين الأقدم
    'Staff',              // الموظفين
    'Entry Level'         // المبتدئين
];
        </div>

        <h2>🎛️ جميع الدوال المتاحة</h2>
        
        <div class="code-block">
// تعيين البيانات
window.OrgChartAPI.setData(data, 'orgChart');

// توسيع/طي العقد
window.OrgChartAPI.expandAll();
window.OrgChartAPI.collapseAll();
window.OrgChartAPI.expandNode(nodeId);
window.OrgChartAPI.collapseNode(nodeId);

// البحث والتصفية
window.OrgChartAPI.searchEmployee('اسم الموظف');
window.OrgChartAPI.filterByLevel('Executive');
window.OrgChartAPI.resetFilters();

// التركيز على موظف
window.OrgChartAPI.focusOnEmployee('jobTitleCode أو اسم');

// الحصول على إحصائيات
const stats = window.OrgChartAPI.getStats();

// مسح المخطط
window.OrgChartAPI.clearChart();
        </div>

        <div class="success">
            <strong>✅ نصائح مهمة:</strong>
            <ul>
                <li>تأكد من انتظار الـ event <code>OrgChartReady</code> قبل استخدام الـ API</li>
                <li>استخدم <code>setData</code> بدلاً من <code>init</code></li>
                <li>تأكد من وجود جميع الحقول المطلوبة في البيانات</li>
                <li>استخدم <code>children: []</code> حتى لو كانت فارغة</li>
            </ul>
        </div>

        <div class="error">
            <strong>❌ أخطاء شائعة:</strong>
            <ul>
                <li>استخدام الـ API قبل جاهزيته</li>
                <li>نسيان الحقول المطلوبة مثل <code>jobTitleCode</code> و <code>level</code></li>
                <li>عدم تضمين <code>children</code> في البيانات</li>
                <li>استخدام <code>init</code> بدلاً من <code>setData</code></li>
            </ul>
        </div>
    </div>
</body>
</html>